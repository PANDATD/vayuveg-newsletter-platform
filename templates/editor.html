<!doctype html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>Newsletter Editor</title>

        <style>
            :root {
                --bg: #f3f4f6;
                --surface: #ffffff;
                --border: #dcdcdc;
                --text: #111827;
                --muted: #6b7280;
                --accent: #0f2a44;
            }

            * {
                box-sizing: border-box;
            }

            body {
                margin: 0;
                font-family: Georgia, "Segoe UI", system-ui, serif;
                color: var(--text);
                background: var(--bg);
            }

            /* LAYOUT */
            .wrap {
                display: flex;
                height: 100vh;
            }

            /* EDITOR PANE */
            .left {
                width: 45%;
                display: flex;
                flex-direction: column;
                background: #f9fafb;
                border-right: 1px solid var(--border);
            }

            /* HEADER */
            .editor-header {
                padding: 16px 20px;
                font-size: 16px;
                font-weight: 700;
                letter-spacing: 0.3px;
                border-bottom: 1px solid var(--border);
                background: var(--surface);
            }

            /* FORM BODY */
            .editor-body {
                padding: 20px;
                overflow-y: auto;
            }

            /* LABELS */
            label {
                font-size: 13px;
                font-weight: 600;
                margin-bottom: 4px;
                display: block;
            }

            /* INPUTS */
            input,
            textarea,
            select {
                width: 100%;
                padding: 9px 10px;
                font-size: 14px;
                border: 1px solid var(--border);
                border-radius: 6px;
                margin-bottom: 14px;
                background: #fff;
            }

            textarea {
                min-height: 100px;
            }

            /* ACTION BAR */
            .actions {
                position: sticky;
                top: 0;
                background: #f9fafb;
                padding: 14px 0 18px;
                display: flex;
                gap: 10px;
                z-index: 5;
            }

            button {
                padding: 8px 14px;
                font-size: 13px;
                border-radius: 6px;
                border: 1px solid var(--border);
                background: #fff;
                cursor: pointer;
            }

            button.primary {
                background: var(--accent);
                color: #fff;
                border-color: var(--accent);
            }

            button:hover {
                opacity: 0.9;
            }

            /* ARTICLES */
            .article {
                background: var(--surface);
                border: 1px solid var(--border);
                border-radius: 10px;
                padding: 18px;
                margin-bottom: 20px;
            }

            .article legend {
                font-size: 14px;
                font-weight: 700;
                padding: 0 8px;
                color: var(--accent);
            }

            /* GRID */
            .row {
                display: flex;
                gap: 12px;
            }

            .row > div {
                flex: 1;
            }

            /* REMOVE */
            .removeBtn {
                margin-top: 8px;
                border-color: #b91c1c;
                color: #b91c1c;
            }

            /* PREVIEW */
            .right {
                width: 55%;
                padding: 24px;
                background: #e5e7eb;
            }

            .preview-frame {
                height: 100%;
                background: #fff;
                border-radius: 14px;
                border: 1px solid var(--border);
                box-shadow: 0 10px 28px rgba(0, 0, 0, 0.06);
                overflow: hidden;
            }

            iframe {
                width: 100%;
                height: 100%;
                border: none;
            }

            /* HINT */
            .hint {
                font-size: 12px;
                color: var(--muted);
                margin-bottom: 16px;
            }
        </style>
    </head>

    <body>
        <div class="wrap">
            <div class="left">
                <div class="editor-header">Newsletter Editor</div>

                <form
                    method="POST"
                    action="/preview"
                    target="previewFrame"
                    id="editorForm"
                    class="editor-body"
                >
                    <label>Theme</label>
                    <select name="theme">
                        <option value="classic">Classic</option>
                        <option value="magazine" selected>Magazine</option>
                        <option value="saffron">Saffron</option>
                    </select>

                    <div class="actions">
                        <button class="primary" type="submit">
                            Update Preview
                        </button>
                        <button type="button" id="addArticleBtn">
                            Add Article
                        </button>
                        <button
                            type="submit"
                            formaction="/export"
                            formtarget="_self"
                        >
                            Save HTML
                        </button>
                    </div>

                    <div class="hint">
                        Summaries support Markdown formatting.
                    </div>

                    <div id="articles">
                        <fieldset class="article">
                            <legend>Article</legend>

                            <label>Title</label>
                            <input name="title" />

                            <label>Summary</label>
                            <textarea name="summary"></textarea>

                            <div class="row">
                                <div>
                                    <label>Image URL</label>
                                    <input name="image" />
                                </div>
                                <div>
                                    <label>Article URL</label>
                                    <input name="url" />
                                </div>
                            </div>

                            <button
                                type="button"
                                class="removeBtn"
                                style="display: none"
                            >
                                Remove Article
                            </button>
                        </fieldset>
                    </div>
                </form>
            </div>

            <div class="right">
                <div class="preview-frame">
                    <iframe name="previewFrame"></iframe>
                </div>
            </div>
        </div>

        <script>
            const articles = document.getElementById("articles");
            const addBtn = document.getElementById("addArticleBtn");

            function updateRemoveButtons() {
                const blocks = articles.querySelectorAll(".article");
                blocks.forEach((b) => {
                    const btn = b.querySelector(".removeBtn");
                    btn.style.display =
                        blocks.length > 1 ? "inline-block" : "none";
                    btn.onclick = () => {
                        b.remove();
                        updateRemoveButtons();
                    };
                });
            }

            addBtn.addEventListener("click", () => {
                const first = articles.querySelector(".article");
                const clone = first.cloneNode(true);
                clone
                    .querySelectorAll("input, textarea")
                    .forEach((el) => (el.value = ""));
                articles.appendChild(clone);
                updateRemoveButtons();
            });

            updateRemoveButtons();
        </script>
    </body>
</html>
